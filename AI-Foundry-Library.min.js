const foundry={textToText:async function({api_token:e,model:o="hermes-2-pro-llama-3-8b",prompt:t,messages:r,temperature:n=.9,maxTokens:i=250,logging:a=!0,loadingElementSelector:c,resultElementSelector:l}){if(e){a&&console.log("Running text-to-text function"),r||(t||(console.error("No prompt given. Empty message created."),t=""),r=[{role:"user",content:t}]);try{c&&(document.querySelector(c)?document.querySelector(c).setAttribute("aria-busy","true"):console.error("Element selected for loading indicator not found"));const t=await fetch("https://data.id.tue.nl/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({messages:r,model:o,temperature:n,max_tokens:i})});let s=(await t.json()).choices[0].message.content;return a&&console.log("Result:",s),l&&(document.querySelector(l).innerHTML+=s),c&&(document.querySelector(c)?document.querySelector(c).setAttribute("aria-busy","false"):console.error("Element selected for loading indicator not found")),s}catch(e){console.error("Error:",e)}}else console.error("No API key provided.")},textToImage:async function({api_token:e,prompt:o,temperature:t=.9,logging:r=!0,loadingElementSelector:n,resultElementSelector:i,steps:a=20,width:c=512,height:l=512}){if(r&&console.log("Running text-to-image function"),e)try{n&&(document.querySelector(n)?document.querySelector(n).setAttribute("aria-busy","true"):console.error("Element selected for loading indicator not found"));const s=await fetch("https://data.id.tue.nl/v1/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({prompt:o,steps:a,width:c,height:l,temperature:t})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const d=await s.json();return r&&console.log("Generated image:",d.image_url),i&&(document.querySelector(i).src=d.image_url),n&&(document.querySelector(n)?document.querySelector(n).setAttribute("aria-busy","false"):console.error("Element selected for loading indicator not found")),d.image_url}catch(e){console.error("There was a problem with the fetch operation:",e.message)}else console.error("No API key provided.")},textToSound:async function({api_token:e,projectId:o,prompt:t,language:r="en",loadingElementSelector:n,resultElementSelector:i,logging:a=!0}){if(e)if(o){a&&console.log("Running text-to-sound function"),n&&(document.querySelector(n)?document.querySelector(n).setAttribute("aria-busy","true"):console.error("Element selected for loading indicator not found"));try{const c=await fetch(`https://data.id.tue.nl/api/vendor/t2s/${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({lang:r,text:t})}),l=await c.json(),s="https://data.id.tue.nl/api/vendor/t2s/"+l.text;return a&&console.log("Generated audio:",s),void 0===l.text&&console.error("No result. It is possible your API Key and project ID are not matching."),n&&(document.querySelector(n)?document.querySelector(n).setAttribute("aria-busy","false"):console.error("Element selected for loading indicator not found")),i&&(document.querySelector(i).src=s),s}catch(e){console.error(e)}}else console.error("No project ID provided. Please find your project ID at the info section of your project.");else console.error("No API key provided.")},imageToText:async function({api_token:e,model:o="llava-llama-3-8b-v1_1",userPrompt:t,systemPrompt:r,image:n,popup:i=!1,temperature:a=.9,maxTokens:c=250,logging:l=!0,loadingElementSelector:s,resultElementSelector:d}){if(e){if(l&&console.log("Running image-to-text function"),i){document.querySelector("#df_fileInput")||(document.body.innerHTML+='<input type="file" id="df_fileInput" accept="image/*" style="display: none;" onchange=""></input>'),document.querySelector("#df_fileInput").click();try{n=await new Promise(((e,o)=>{const t=document.querySelector("#df_fileInput");t?t.onchange=async function(t){const r=t.target.files;if(r&&r.length>0){const t=r[0];l&&console.log("File selected:",t);try{n=await u(t),e(n)}catch(e){o(new Error("Error during image processing"))}}else o(new Error("No file selected"))}:o(new Error("File input element not found"))}))}catch(e){console.error("Error:",e.message)}}else n=await u(n);messages=[{role:"system",content:r},{role:"user",content:[{type:"text",text:t},{type:"image_url",image_url:{url:n}}]}];try{s&&(document.querySelector(s)?document.querySelector(s).setAttribute("aria-busy","true"):console.error("Element selected for loading indicator not found"));const t=await fetch("https://data.id.tue.nl/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({messages:messages,model:o,temperature:a,max_tokens:c})});let r=(await t.json()).choices[0].message.content;return l&&console.log("Result:",r),d&&(document.querySelector(d).innerHTML+=r),s&&(document.querySelector(s)?document.querySelector(s).setAttribute("aria-busy","false"):console.error("Element selected for loading indicator not found")),r}catch(e){console.error("Error:",e)}}else console.error("No API key provided.");function u(e){return new Promise(((o,t)=>{if(e instanceof File){const r=new FileReader;r.onload=function(e){const r=new Image;r.src=e.target.result,r.onload=function(){m(r).then(o)},r.onerror=function(){t(new Error("Error loading image from file"))}},r.onerror=function(){t(new Error("Error reading the image file"))},r.readAsDataURL(e)}else if("string"==typeof e){const r=new Image;r.crossOrigin="Anonymous",r.src=e,r.onload=function(){m(r).then(o)},r.onerror=function(){t(new Error("Error loading image from URL"))}}else t(new Error("Invalid image source"))}))}function m(e){return new Promise((o=>{const t=document.createElement("canvas"),r=t.getContext("2d");let n=e.width,i=e.height;n>i?n>800&&(i*=800/n,n=800):i>800&&(n*=800/i,i=800),t.width=n,t.height=i,r.drawImage(e,0,0,n,i);const a=t.toDataURL("image/jpeg",.5);l&&console.log("Image processed."),o(a)}))}},soundToText:async function({api_token:e,type:o="file",sliceDuration:t=5e3,file:r,resultElementSelector:n,loadingElementSelector:i,logging:a=!0,stopRec:c=!1}){if(!e)return void console.error("No API key provided.");if(c){return await async function(){return new Promise((o=>{recordAudio.stopRecording((async function(){var t=recordAudio.getBlob();let r=await s({api_token:e,file:t,type:"file"});n&&(document.querySelector(n).innerHTML+=r),o(r)}))}))}()}let l="";if("record"===o&&function(e){if("undefined"!=typeof RecordRTC)a&&console.log("RecordRTC is already loaded."),e();else{a&&console.log("RecordRTC is not loaded, adding script to the page.");var o=document.createElement("script");o.src="https://cdn.webrtc-experiment.com/RecordRTC.js",o.async=!0,o.onload=function(){a&&console.log("RecordRTC has been loaded."),e()},document.head.appendChild(o)}}((function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(o){recordAudio=RecordRTC(o,{type:"audio",mimeType:"audio/webm",sampleRate:44100,recorderType:StereoAudioRecorder,numberOfAudioChannels:1,desiredSampRate:16e3,timeSlice:t,disableLogs:!a,ondataavailable:async function(o){l+=await s({api_token:e,file:o}),a&&console.log("Transcription:",l),n&&(document.querySelector(n).innerHTML+=l)}}),recordAudio.startRecording()})).catch((e=>{console.error(`${e.name}: ${e.message}`)}))})),"popup"===o){document.querySelector("#df_audioFileInput")||(document.body.innerHTML+='<input type="file" id="df_audioFileInput" accept="audio/*" style="display: none;" onchange=""></input>'),document.querySelector("#df_audioFileInput").click();try{let o=await new Promise(((e,o)=>{const t=document.querySelector("#df_audioFileInput");t?t.onchange=async function(t){const r=t.target.files;if(r&&r.length>0){const t=r[0];a&&console.log("File selected:",t);try{e(t)}catch(e){o(new Error("Error during image processing"))}}else o(new Error("No file selected"))}:o(new Error("File input element not found"))}));return await s({api_token:e,file:o})}catch(e){console.error("Error:",e.message)}}if("file"===o)return await s({api_token:e,file:r});async function s({model:o="whisper-base",file:t}){const r=new FormData;r.append("model",o),r.append("file",t);try{i&&(document.querySelector(i)?document.querySelector(i).setAttribute("aria-busy","true"):console.error("Element selected for loading indicator not found"));const o=await fetch("https://data.id.tue.nl/v1/audio/transcriptions",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r}),t=await o.json();return a&&console.log("Result:",t.text),i&&(document.querySelector(i)?document.querySelector(i).setAttribute("aria-busy","false"):console.error("Element selected for loading indicator not found")),t.text}catch(e){console.error(e.message)}}},models:async function(e){try{const o=await fetch("https://data.id.tue.nl/v1/models",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),t=(await o.json()).data;return console.log("Models:",t),t}catch(e){console.error(e)}},messageHistory:[]};